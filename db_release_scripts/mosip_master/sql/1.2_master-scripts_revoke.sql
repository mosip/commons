-- --------------------------------------------------------------------------------------------------------
-- Database Name: mosip_master
-- Release Version 	: 1.1.5
-- Purpose    		: Revoking Database Alter deployement done for release in Master DB.       
-- Create By   		: Ram Bhatt
-- Created Date		: Jan-2021
-- 
-- Modified Date        Modified By         Comments / Remarks
-- -----------------------------------------------------------------------------------------------------------

-- -----------------------------------------------------------------------------------------------------------
\c mosip_master sysadmin

DROP TABLE master.ui_spec;

ALTER TABLE master.identity_schema ADD COLUMN id_attr_json character varying;


UPDATE TABLE master.identity_schema SET id_attr_json ='[{"id":"IDSchemaVersion","description":"ID Schema Version","label":{"eng":"IDSchemaVersion"},"type":"number","minimum":0,"maximum":0,"controlType":null,"fieldType":"default","format":"none","fieldCategory":"none","inputRequired":false,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"IdSchemaVersion","contactType":null,"group":null,"alignmentGroup":null,"visible":null,"changeAction":null,"required":true},{"id":"UIN","description":"UIN","label":{"eng":"UIN"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"none","inputRequired":false,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"UIN","contactType":null,"group":null,"alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"fullName","description":"Full Name","label":{"ara":"الاسم الكامل","eng":"Full Name","fra":"Nom complet"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{3,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"name","contactType":null,"group":"FullName","alignmentGroup":null,"visible":null,"changeAction":null,"required":true},{"id":"dateOfBirth","description":"dateOfBirth","label":{"ara":"الاسم الكامل","eng":"DOB","fra":"DOB"},"type":"string","minimum":0,"maximum":0,"controlType":"ageDate","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(1869|18[7-9][0-9]|19[0-9][0-9]|20[0-9][0-9])/([0][1-9]|1[0-2])/([0][1-9]|[1-2][0-9]|3[01])$","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"identity.isNew || (identity.isUpdate && (identity.updatableFieldGroups contains ''GuardianDetails'' || identity.updatableFieldGroups contains ''DateOfBirth''))"}],"subType":"dateOfBirth","contactType":null,"group":"DateOfBirth","alignmentGroup":null,"visible":null,"changeAction":null,"required":true},{"id":"gender","description":"gender","label":{"ara":"الاسم الكامل","eng":"Gender","fra":"Le genre"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"dynamic","format":"","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"gender","contactType":null,"group":"Gender","alignmentGroup":"group1","visible":null,"changeAction":null,"required":true},{"id":"addressLine1","description":"addressLine1","label":{"ara":"الاسم الكامل","eng":"line1","fra":"line1"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{0,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"addressLine1","contactType":"Postal","group":"Address","alignmentGroup":"address","visible":null,"changeAction":null,"required":true},{"id":"addressLine2","description":"addressLine2","label":{"ara":"الاسم الكامل","eng":"line2","fra":"line2"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{3,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"addressLine2","contactType":"Postal","group":"Address","alignmentGroup":"address","visible":null,"changeAction":null,"required":true},{"id":"addressLine3","description":"addressLine3","label":{"ara":"الاسم الكامل","eng":"line3","fra":"line3"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{3,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"addressLine3","contactType":"Postal","group":"Address","alignmentGroup":"address","visible":null,"changeAction":null,"required":true},{"id":"residenceStatus","description":"residenceStatus","label":{"ara":"الاسم الكامل","eng":"Residence Status","fra":"Reside Status"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"dynamic","format":"none","fieldCategory":"kyc","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"residenceStatus","contactType":null,"group":"ResidenceStatus","alignmentGroup":"group1","visible":null,"changeAction":null,"required":false},{"id":"referenceIdentityNumber","description":"referenceIdentityNumber","label":{"ara":"الاسم الكامل","eng":"Reference Identity Number","fra":"Reference Identity Number"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"kyc","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^([0-9]{10,30})$","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"none","contactType":null,"group":"ReferenceIdentityNumber","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"region","description":"region","label":{"ara":"الاسم الكامل","eng":"Region","fra":"Region"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{0,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"Region","contactType":"Postal","group":"Location","alignmentGroup":"location","visible":null,"changeAction":null,"required":true},{"id":"province","description":"province","label":{"ara":"الاسم الكامل","eng":"Province","fra":"Province"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{0,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"Province","contactType":"Postal","group":"Location","alignmentGroup":"location","visible":null,"changeAction":null,"required":true},{"id":"city","description":"city","label":{"ara":"الاسم الكامل","eng":"City","fra":"City"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^(?=.{0,50}$).*","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"City","contactType":"Postal","group":"Location","alignmentGroup":"location","visible":null,"changeAction":null,"required":true},{"id":"zone","description":"zone","label":{"ara":"الاسم الكامل","eng":"Zone","fra":"Zone"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"Zone","contactType":null,"group":"Location","alignmentGroup":"location","visible":null,"changeAction":null,"required":true},{"id":"postalCode","description":"postalCode","label":{"ara":"الاسم الكامل","eng":"Postal","fra":"Postal"},"type":"string","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^[(?i)A-Z0-9]{5}$|^NA$","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"Postal Code","contactType":"Postal","group":"Location","alignmentGroup":"location","visible":null,"changeAction":null,"required":true},{"id":"phone","description":"phone","label":{"ara":"الاسم الكامل","eng":"Phone","fra":"Phone"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^[+]*([0-9]{1})([0-9]{9})$","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"Phone","contactType":"email","group":"Phone","alignmentGroup":"contact","visible":null,"changeAction":null,"required":true},{"id":"email","description":"email","label":{"ara":"الاسم الكامل","eng":"Email","fra":"Email"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[{"type":"regex","validator":"^[A-Za-z0-9_\\-]+(\\.[A-Za-z0-9_]+)*@[A-Za-z0-9_-]+(\\.[A-Za-z0-9_]+)*(\\.[a-zA-Z]{2,})$","arguments":[],"langCode":null}],"bioAttributes":null,"requiredOn":[],"subType":"Email","contactType":"email","group":"Email","alignmentGroup":"contact","visible":null,"changeAction":null,"required":true},{"id":"modeOfClaim","description":"Mode of Claim","label":{"ara":"الاسم الكامل","eng":"Mode of claim","fra":"Mode of Claim"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"dropdown","fieldType":"dynamic","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"modeOfClaim","contactType":null,"group":"modeOfClaim","alignmentGroup":"contact","visible":null,"changeAction":null,"required":true},{"id":"parentOrGuardianName","description":"parentOrGuardianName","label":{"ara":"الاسم الكامل","eng":"Parent Name","fra":"Parent Name"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"( identity.isNew && identity.isChild ) || ( identity.isUpdate && identity.isChild )"}],"subType":"parentOrGuardianName","contactType":null,"group":"GuardianDetails","alignmentGroup":"introducer","visible":{"engine":"MVEL","expr":"( identity.isNew && identity.isChild ) || ( identity.isUpdate && identity.isChild )"},"changeAction":null,"required":false},{"id":"parentOrGuardianRID","description":"parentOrGuardianRID","label":{"ara":"الاسم الكامل","eng":"Parent RID","fra":"Parent RID"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"( identity.isChild && (identity.parentOrGuardianUIN == nil || identity.parentOrGuardianUIN == empty) )"}],"subType":"RID","contactType":null,"group":"GuardianDetails","alignmentGroup":"introducer","visible":{"engine":"MVEL","expr":"( identity.isChild && (identity.parentOrGuardianUIN == nil || identity.parentOrGuardianUIN == empty) )"},"changeAction":null,"required":false},{"id":"parentOrGuardianUIN","description":"parentOrGuardianUIN","label":{"ara":"الاسم الكامل","eng":"Parent UIn","fra":"Parent UIN"},"type":"string","minimum":0,"maximum":0,"controlType":"textbox","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"( identity.isChild && (identity.parentOrGuardianRID == nil || identity.parentOrGuardianRID == empty) )"}],"subType":"UIN","contactType":null,"group":"GuardianDetails","alignmentGroup":"introducer","visible":{"engine":"MVEL","expr":"( identity.isChild && (identity.parentOrGuardianRID == nil || identity.parentOrGuardianRID == empty) )"},"changeAction":null,"required":false},{"id":"proofOfAddress","description":"proofOfAddress","label":{"ara":"إثبات العنوان","eng":"Address Proof","fra":"Address Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"identity.isNew || ( identity.isUpdate && (identity.updatableFields contains ''addressLine1'' || identity.updatableFields contains ''addressLine2'' || identity.updatableFields contains ''addressLine3''))"}],"subType":"POA","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"proofOfIdentity","description":"proofOfIdentity","label":{"ara":"إثبات الهوية","eng":"Identity Proof","fra":"Identity Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"identity.isNew || ( identity.isUpdate && identity.updatableFields contains ''fullName'')"}],"subType":"POI","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":true},{"id":"proofOfRelationship","description":"proofOfRelationship","label":{"ara":"إثبات العلاقة","eng":"Relationship Proof","fra":"Relationship Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"( identity.isNew && identity.isChild ) || ( identity.isUpdate && (identity.updatableFieldGroups contains ''GuardianDetails'' || identity.isChild))"}],"subType":"POR","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"proofOfDateOfBirth","description":"proofOfDateOfBirth","label":{"ara":"دليل DOB","eng":"DOB Proof","fra":"DOB Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[{"engine":"MVEL","expr":"identity.isUpdate && identity.updatableFields contains ''dateOfBirth''"}],"subType":"POB","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"proofOfException","description":"proofOfException","label":{"ara":"إثبات الاستثناء","eng":"Exception Proof","fra":"Exception Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"POE","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"proofOfException-1","description":"proofOfException","label":{"ara":"إثبات الاستثناء 2","eng":"Exception Proof","fra":"Exception Proof"},"type":"documentType","minimum":0,"maximum":0,"controlType":"fileupload","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"POE","contactType":null,"group":"Documents","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"individualBiometrics","description":"","label":{"ara":"القياسات الحيوية الفردية","eng":"Applicant Biometrics","fra":"Applicant Biometrics"},"type":"biometricsType","minimum":0,"maximum":0,"controlType":"biometrics","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":["leftEye","rightEye","rightIndex","rightLittle","rightRing","rightMiddle","leftIndex","leftLittle","leftRing","leftMiddle","leftThumb","rightThumb","face"],"requiredOn":[{"engine":"MVEL","expr":"(identity.isNew || identity.isLost || ( identity.isUpdate && identity.updatableFieldGroups contains ''Biometrics''))"}],"subType":"applicant","contactType":null,"group":"Biometrics","alignmentGroup":null,"visible":null,"changeAction":null,"required":true},{"id":"individualAuthBiometrics","description":"Used to hold biometrics only for authentication","label":{"ara":"القياسات الحيوية الفردية","eng":"Authentication Biometrics","fra":"Authentication Biometrics"},"type":"biometricsType","minimum":0,"maximum":0,"controlType":"biometrics","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":["leftEye","rightEye","rightIndex","rightLittle","rightRing","rightMiddle","leftIndex","leftLittle","leftRing","leftMiddle","leftThumb","rightThumb","face"],"requiredOn":[{"engine":"MVEL","expr":"!identity.isChild && identity.isUpdate && !(identity.updatableFieldGroups contains ''Biometrics'' || identity.updatableFieldGroups contains ''GuardianDetails'')"}],"subType":"applicant-auth","contactType":null,"group":null,"alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"parentOrGuardianBiometrics","description":"","label":{"ara":"القياسات الحيوية للوالدين","eng":"Guardian Biometrics","fra":"Guardian Biometrics"},"type":"biometricsType","minimum":0,"maximum":0,"controlType":"biometrics","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":["leftEye","rightEye","rightIndex","rightLittle","rightRing","rightMiddle","leftIndex","leftLittle","leftRing","leftMiddle","leftThumb","rightThumb","face"],"requiredOn":[{"engine":"MVEL","expr":"(identity.isChild && identity.isNew) || (identity.isUpdate && identity.updatableFieldGroups contains ''GuardianDetails'')"}],"subType":"introducer","contactType":null,"group":"Biometrics","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"consentText","description":"Applicant consent text","label":{"ara":"موافقة مقدم الطلب","eng":"Applicant Consent","fra":"Consentement du demandeur"},"type":"simpleType","minimum":0,"maximum":0,"controlType":"html","fieldType":"default","format":"none","fieldCategory":"evidence","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"consent","contactType":null,"group":"consent","alignmentGroup":null,"visible":null,"changeAction":null,"required":false},{"id":"consent","description":"Applicant consent flag","label":{"ara":"أقبل مشاركة معلومات تحديد الهوية الشخصية الخاصة بي","eng":"I accept to share my PII","fra":"J''accepte de partager mes PII"},"type":"string","minimum":0,"maximum":0,"controlType":"checkbox","fieldType":"default","format":"none","fieldCategory":"pvt","inputRequired":true,"validators":[],"bioAttributes":null,"requiredOn":[],"subType":"consent","contactType":null,"group":"consent","alignmentGroup":null,"visible":null,"changeAction":null,"required":true}]';


--------------------------------------------------------------------------------------------------------------
ALTER TABLE master.bulkupload_transaction ALTER COLUMN upload_description character varying(256);


-----------------------------------------------------------------------------------------------------------------

ALTER TABLE master.ui_spec ALTER COLUMN version TYPE numeric(5);
ALTER TABLE master.ui_spec ALTER COLUMN identity_schema_version TYPE numeric(5);
